namespace = communist_elections
namespace = cable_street

# International Socialism
communist_elections.3 = {
	type = country_event
	placement = ROOT
	
	title = communist_elections.3.t
	desc = communist_elections.3.d
	flavor = communist_elections.3.f
	
	event_image = {
		video = "europenorthamerica_political_extremism"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/waving_flag.dds"
	
	duration = 3
	
	trigger = {
		NOT = { has_law = law_type:law_single_party_state }
		in_election_campaign = yes
		NOT = { has_variable = international_socialism_var }
		any_country = {
			NOT = { has_war_with = ROOT }
			country_rank >= rank_value:major_power
			any_interest_group = {
				is_marginal = no
				leader = {
					OR = {
						has_ideology = ideology:ideology_anarchist
						has_ideology = ideology:ideology_communist
						has_ideology = ideology:ideology_vanguardist
						        has_ideology = ideology:ideology_syndicalism					
						        has_ideology = ideology:ideology_left_communism
						        has_ideology = ideology:ideology_technocratic_socialism						
					}
				}
			}
		}
		any_active_party = {
			OR = {
				is_party_type = communist_party
				is_party_type = social_democrat_party
				is_party_type = anarchist_party
						is_party_type = communist_rebelist
						is_party_type = left_radical
						is_party_type = old_conservative					
			}
		}
	}

	immediate = {
		set_variable = {
			name = international_socialism_var
			months = short_modifier_time
		}
		random_interest_group = {
			limit = {
				has_party = yes
				party = {
					OR = {
						is_party_type = communist_party
						is_party_type = social_democrat_party
						is_party_type = anarchist_party
						is_party_type = communist_rebelist
						is_party_type = left_radical
						is_party_type = old_conservative						
					}
				}
			}
			party = {
				save_scope_as = socialist_party
			}
		}
		random_country = {
			limit = {
				NOT = { has_war_with = ROOT }
				country_rank >= rank_value:major_power
				any_interest_group = {
					is_marginal = no
					leader = {
						OR = {
							has_ideology = ideology:ideology_anarchist
							has_ideology = ideology:ideology_communist
							has_ideology = ideology:ideology_vanguardist
						        has_ideology = ideology:ideology_syndicalism					
						        has_ideology = ideology:ideology_left_communism
						        has_ideology = ideology:ideology_technocratic_socialism
						}
					}
				}
			}
			save_scope_as = socialist_country
			random_interest_group = {
				limit = {
					is_marginal = no
					leader = {
						OR = {
							has_ideology = ideology:ideology_anarchist
							has_ideology = ideology:ideology_communist
							has_ideology = ideology:ideology_vanguardist
						        has_ideology = ideology:ideology_syndicalism					
						        has_ideology = ideology:ideology_left_communism
						        has_ideology = ideology:ideology_technocratic_socialism
						}
					}
				}
				save_scope_as = foreign_socialist_ig
				leader = {
					save_scope_as = foreign_socialist_leader
				}
			}
		}
	}
	
	cancellation_trigger = {
		in_election_campaign = no
	}

	option = { # welcome international support
		name = communist_elections.3.a
		default_option = yes
		scope:socialist_party = {
			add_momentum = momentum_large
		}
		# improve relations with socialist country if the socialists are in power
		if = {
			limit = {
				scope:foreign_socialist_ig = {
					is_in_government = yes
				}
			}
			scope:socialist_country = {
				change_relations = {
					country = ROOT
					value = 20
				}
			}
		}
		# owe a favor to the socialist country if you both have socialist governments
		if = {
			limit = {
				NOT = { owes_obligation_to = scope:socialist_country }
				scope:foreign_socialist_ig = {
					is_in_government = yes
				}
				scope:socialist_party = {
					any_member = {
						is_in_government = yes
					}
				}
			}
			set_owes_obligation_to = {
				country = scope:socialist_country
				setting = yes
			}
		}
		# These variables increase the chances of generating new leaders with each ideology
		if = {
			limit = {
				scope:foreign_socialist_leader = {
				OR = {
					has_ideology = ideology:ideology_vanguardist
					has_ideology = ideology:ideology_technocratic_socialism
					}
				}
			}
			set_variable = {
				name = election_vanguardist_support
				months = long_modifier_time
			}
			custom_tooltip = election_socialist_support_tt
		}
		else_if = {
			limit = {
				scope:foreign_socialist_leader = {
				OR = {
					has_ideology = ideology:ideology_anarchist
					has_ideology = ideology:ideology_syndicalism
					}
				}
			}
			set_variable = {
				name = election_anarchist_support
				months = long_modifier_time
			}
			custom_tooltip = election_socialist_support_tt
		}
		else_if = {
			limit = {
				scope:foreign_socialist_leader = {
				OR = {					
					has_ideology = ideology:ideology_left_communism			
					has_ideology = ideology:ideology_communist
					}
				}
			}
			set_variable = {
				name = election_communist_support
				months = long_modifier_time
			}
			custom_tooltip = election_socialist_support_tt
		}
	}

	option = { # Limit foreign influence
		name = communist_elections.3.b
		scope:socialist_party = {
			add_momentum = momentum_small
		}
	}

	option = { # expel foreign infiltrators
		name = communist_elections.3.c
		trigger = {
			scope:socialist_party = {
				NOT = {
					any_member = {
						is_in_government = yes
					}
				}
			}
			OR = {
				has_law = law_type:law_closed_borders
				has_law = law_type:law_outlawed_dissent
				has_law = law_type:law_secret_police
			}
		}
		scope:socialist_party = {
			add_momentum = momentum_large_decrease
		}
		# harm relations with socialist country if they have a socialist government
		if = {
			limit = {
				scope:foreign_socialist_ig = {
					is_in_government = yes
				}
			}
			scope:socialist_country = {
				change_relations = {
					country = ROOT
					value = -20
				}
			}
		}
	}
}


